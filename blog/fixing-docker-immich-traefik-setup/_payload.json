[{"data":1,"prerenderedAt":271},["ShallowReactive",2],{"article":3,"articles-100":171,"articles-10":250},{"id":4,"title":5,"alt":6,"body":7,"date":155,"description":156,"extension":157,"head":155,"image":158,"meta":159,"navigation":160,"ogImage":155,"path":161,"postDate":162,"provider":155,"published":163,"robots":155,"schemaOrg":155,"seo":164,"sitemap":165,"stem":166,"tags":167,"url":155,"__hash__":170},"blog/blog/fixing-docker-immich-traefik-setup.md","Fixing my broken Docker Immich+Traefik setup","Depiction of broken docker networking",{"type":8,"value":9,"toc":148},"minimark",[10,22,25,28,31,36,45,64,67,70,74,77,80,87,90,94,97,114,121,131,138,142,145],[11,12,13,14,21],"p",{},"I have been using ",[15,16,20],"a",{"href":17,"rel":18},"https://github.com/immich-app/immich",[19],"nofollow","Immich"," for over a year in my homelab. Immich is a photo and video management platform similar to Google Photos or iCloud Photos, but it is self-hosted. This means I own and control all data. It is open-source, runs on my own infrastructure, no subscriptions, and no company uses my family photos to train models.",[11,23,24],{},"Until recently, Immich was in beta. Things break in beta. That's kind of the point. I had this problem where new pictures and videos added to my external library weren't being indexed, and metadata wasn't extracted for many of these assets. I chalked it up to active development and moved on.",[11,26,27],{},"Immich hit stable version recently. Kudos to the team and the contributors for making it happen and giving us a great alternative to proprietary platforms.",[11,29,30],{},"After learning about the stable release, I pulled the latest version hoping that the issues I was facing would be fixed. Unfortunately, my photos and videos still weren't being indexed after a certain point and none of the jobs seem to work. I looked for pending issues but found none that match my problem. Then it occurred to me that maybe the issue wasn't in Immich itself. Maybe it was my setup.",[32,33,35],"h2",{"id":34},"the-setup","The Setup",[11,37,38,39,44],{},"I'm running Immich and all related services on my homelab on an Ubuntu VM using Docker Compose, mostly following the ",[15,40,43],{"href":41,"rel":42},"https://docs.immich.app/install/docker-compose",[19],"official documentation",".",[11,46,47,48,53,54,59,60],{},"At some point in the past, I had introduced ",[15,49,52],{"href":50,"rel":51},"https://doc.traefik.io/traefik/",[19],"Traefik"," as a reverse proxy for Immich, following the ",[15,55,58],{"href":56,"rel":57},"https://www.youtube.com/watch?v=CmUzMi5QLzI",[19],"tutorial from Jim's Garage",". Traefik gives me domain-based access to services instead of me having to remember the IP address and port number for them. The services are still accessible only on my home network, but I can reach them using an easy-to-remember address like ",[61,62,63],"code",{},"https://photos.home.mydomain.com",[11,65,66],{},"All I had to do was add a proxy network to the services and some Traefik labels to specify the domain. A quick check had shown that I could access my previous photos and videos correctly, so I assumed everything was working.",[11,68,69],{},"But it turns out not everything was.",[32,71,73],{"id":72},"the-issue","The Issue",[11,75,76],{},"I had connected every service to the same proxy network. One network, everything talks to everything. What could go wrong, right?",[11,78,79],{},"Immich could connect to Postgres just fine and retrieve data about previously indexed photos and videos. Redis, though, wasn't receiving any jobs which caused the asynchrounous background tasks like scanning libraries to not be initiated at all.",[11,81,82,83,86],{},"To try to isolate the networking issue, I commented out the proxy network usage for all services and accessed immich using ",[61,84,85],{},"\u003Cserver ip>:\u003Cimmich-server port>",". Running the job for rescanning external libraries worked as intended and I could see the new media in my Immich timeline.",[11,88,89],{},"I still am not 100% sure of the reason but I suspect it to be a timing issue. The external proxy network's DNS wasn't ready when Immich started up. Some connections succeeded by luck or retry logic. Others failed and never recovered. Redis happened to be one that failed.",[32,91,93],{"id":92},"the-fix","The Fix",[11,95,96],{},"I split the setup into two networks:",[98,99,100,108],"ol",{},[101,102,103,107],"li",{},[104,105,106],"strong",{},"Internal network",": Database, Redis, Immich machine learning engine, and Immich all communicate here",[101,109,110,113],{},[104,111,112],{},"Proxy network",": Only Immich server connects here so Traefik can route to it",[11,115,116,117,120],{},"Here's a simplified version of my new ",[61,118,119],{},"docker-compose.yml"," file:",[122,123,128],"pre",{"className":124,"code":126,"language":127},[125],"language-text","services:\n    immich-server:\n        image: immich:latest\n        networks:\n        - internal # Talk to database, Redis, etc.\n        - proxy    # Accessible via Traefik\n        labels:\n        - \"traefik.enable=true\"\n        - \"traefik.docker.network=proxy\"\n        - \"traefik.http.routers.immich.rule=Host(`photos.home.mydomain.com`)\"\n        - \"traefik.http.services.immich.loadbalancer.server.port=3001\"\n\n    immich-machine-learning:\n        networks:\n        - internal\n\n    database:\n        networks:\n        - internal\n\n    redis:\n        networks:\n        - internal\n\n    networks:\n        internal:\n        driver: bridge\n        proxy:\n        external: true\n","text",[61,129,126],{"__ignoreMap":130},"",[11,132,133,134,137],{},"The ",[61,135,136],{},"traefik.docker.network=proxy"," label tells Traefik which network to actually use for routing.",[32,139,141],{"id":140},"how-it-works","How It Works",[11,143,144],{},"The internal network is created fresh, so DNS setup is guaranteed to work. When Immich needs to send jobs to Redis or read from Postgres, the names resolve consistently and quickly. External traffic from Traefik arrives on the proxy network instead. Both networks point to the same containers but through different paths, so the timing issues disappear.",[11,146,147],{},"Now the indexing of photos and all the other jobs, e.g.. extracting metadata, creating thumbnails work as intended.",{"title":130,"searchDepth":149,"depth":149,"links":150},2,[151,152,153,154],{"id":34,"depth":149,"text":35},{"id":72,"depth":149,"text":73},{"id":92,"depth":149,"text":93},{"id":140,"depth":149,"text":141},null,"Photo indexing and other jobs failed in my Immich+Traefik setup. Turns out I'd misconfigured my Docker networking with Traefik. Here's how I figured it out and what I changed.","md","/images/broken-docker-network.png",{},true,"/blog/fixing-docker-immich-traefik-setup","2025-10-31T00:00:00.000Z",false,{"title":5,"description":156},{"loc":161},"blog/fixing-docker-immich-traefik-setup",[168,169],"homelab","networking","TOxH5IuGq4BLbRWN85h7rduwY5kF6mGuucrROTNVo0s",[172,174,185,194,203,209,215,224,231,237,244],{"title":5,"description":156,"tags":173,"postDate":162,"path":161,"url":155},[168,169],{"title":175,"description":176,"tags":177,"postDate":183,"path":184,"url":155},"Quickly Outline Large JSON Responses with a Custom jq Function","Use jq to automatically map and visualize the structure of large JSON responses, perfect for exploring undocumented endpoints.",[178,179,180,181,182],"jq","json","command line","automation","developer productivity","2025-10-19T00:00:00.000Z","/blog/jq-json-outline",{"title":186,"description":187,"tags":188,"postDate":192,"path":193,"url":155},"Why I added RSS feeds to my blog (and how I did it in Nuxt 3)","How I built RSS and Atom feed support for my Nuxt 3 website to let readers follow my content without social media algorithms.",[189,190,191],"nuxt","web development","tutorial","2025-08-31T00:00:00.000Z","/blog/setting-up-rss-atom-feeds-nuxt3",{"title":195,"description":196,"tags":197,"postDate":201,"path":202,"url":155},"Revisiting my Stream Deck for music control","How I turned my neglected Stream Deck into a useful tool for controlling YouTube Music without breaking my workflow.",[198,199,181,200],"productivity","Developer Productivity","home-office","2025-06-07T00:00:00.000Z","/blog/stream-deck-youtube-music",{"title":204,"description":205,"tags":206,"postDate":207,"path":208,"url":155},"fzf + fabric: Smart selection for LLM patterns and models","Enhance your experience with fabric, the AI prompt tool, by using interactive selection for patterns and models.",[182],"2025-05-24T00:00:00.000Z","/blog/ai-pattern-selection-in-fabric",{"title":210,"description":211,"tags":212,"postDate":213,"path":214,"url":155},"Effortless configuration syncing with GNU Stow and Git: A software engineer's workflow","Discover how to manage and sync configuration files across Linux and macOS using GNU Stow and Git. Simplify your workflow with centralized, version-controlled setups.",[182],"2025-01-12T00:00:00.000Z","/blog/effortless-configuration-syncing-with-gnu-stow",{"title":216,"description":217,"tags":218,"postDate":222,"path":223,"url":155},"My 2023 travels: A visual journey","Looking back at the best pictures from my travel adventures in 2023",[219,220,221],"personal","travel","photography","2024-01-01T00:00:00.000Z","/blog/2023-travels-visual-journey",{"title":225,"description":226,"tags":227,"postDate":229,"path":230,"url":155},"Re-living memories through proper media organization","Organizing media such as photos and videos can bring back cherished memories and help relive them. Here's my approach to organizing my digital media collection.",[219,228],"technology","2023-02-06T00:00:00.000Z","/blog/reliving-memories-through-proper-media-organization",{"title":232,"description":233,"tags":234,"postDate":235,"path":236,"url":155},"Looking back: My 2022 in review","From new adventures and memories to lessons learned and personal growth, this year has been a year of discovery. Here's my 2022 in review.",[219,220],"2022-12-31T00:00:00.000Z","/blog/2022-in-review",{"title":238,"description":239,"tags":240,"postDate":242,"path":243,"url":155},"Git and the command-line: Take your workflow to the next level","Some tips on how to improve your Git productivity using the command-line",[241,182],"programming","2022-12-18T00:00:00.000Z","/blog/git-and-command-line-next-level-workflow",{"title":245,"description":246,"tags":247,"postDate":248,"path":249,"url":155},"Hiking Tsho-Rolpa lake trail in Nepal","Details of my hiking journey to the Tsho-Rolpa glacial lake in Nepal 🇳🇵, situated at 4,580m from sea level",[220],"2022-01-22T00:00:00.000Z","/blog/hiking-tsho-rolpa-lake-trail-in-nepal",[251,253,255,257,259,261,263,265,267,269],{"title":5,"description":156,"tags":252,"postDate":162,"path":161,"url":155},[168,169],{"title":175,"description":176,"tags":254,"postDate":183,"path":184,"url":155},[178,179,180,181,182],{"title":186,"description":187,"tags":256,"postDate":192,"path":193,"url":155},[189,190,191],{"title":195,"description":196,"tags":258,"postDate":201,"path":202,"url":155},[198,199,181,200],{"title":204,"description":205,"tags":260,"postDate":207,"path":208,"url":155},[182],{"title":210,"description":211,"tags":262,"postDate":213,"path":214,"url":155},[182],{"title":216,"description":217,"tags":264,"postDate":222,"path":223,"url":155},[219,220,221],{"title":225,"description":226,"tags":266,"postDate":229,"path":230,"url":155},[219,228],{"title":232,"description":233,"tags":268,"postDate":235,"path":236,"url":155},[219,220],{"title":238,"description":239,"tags":270,"postDate":242,"path":243,"url":155},[241,182],1761929891642]